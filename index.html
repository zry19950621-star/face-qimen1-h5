<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <title>ä½ çš„æ°´æœäººæ ¼ç»é…æ˜¯è°ï¼Ÿ</title>

    <!-- ç§»åŠ¨ç«¯é€‚é… -->
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="format-detection" content="telephone=no,email=no" />
    <!-- å‡å°‘å¤–é“¾ä¿¡æ¯ï¼Œå…¼å®¹å¾®ä¿¡ -->
    <meta name="referrer" content="no-referrer" />

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, system-ui,
                         "PingFang SC", "Hiragino Sans GB", "STHeiti",
                         "Microsoft YaHei", sans-serif;
            background-color: #000;
            color: #fff;
            overflow-x: hidden;
        }

        .serif {
            font-family: "STSong", "Songti SC", "FangSong",
                         "Noto Serif CJK SC", serif;
        }

        img {
            user-select: none;
            -webkit-user-drag: none;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to   { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fadeIn 0.8s ease-out forwards; }

        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to   { transform: rotate(360deg); }
        }
        .animate-spin-slow { animation: spin-slow 8s linear infinite; }

        @keyframes bgHeroFloat {
            0%   { transform: scale(1) translateY(0); }
            50%  { transform: scale(1.06) translateY(-8px); }
            100% { transform: scale(1) translateY(0); }
        }
        .bg-hero-animate {
            animation: bgHeroFloat 14s ease-in-out infinite;
            transform-origin: center center;
            will-change: transform;
        }

        .star-twinkle-layer {
            position: absolute;
            inset: 0;
            background-image:
              radial-gradient(circle at 10% 20%, rgba(255,255,255,0.70) 0, rgba(255,255,255,0) 45%),
              radial-gradient(circle at 80% 30%, rgba(255,230,180,0.8) 0, rgba(255,230,180,0) 50%),
              radial-gradient(circle at 20% 80%, rgba(150,200,255,0.7) 0, rgba(150,200,255,0) 55%);
            mix-blend-mode: screen;
            opacity: 0.28;
            animation: starTwinkle 6s ease-in-out infinite alternate;
            pointer-events: none;
        }
        @keyframes starTwinkle {
            0%   { opacity: 0.1; transform: translate3d(0,0,0) scale(1); }
            50%  { opacity: 0.35; transform: translate3d(3px,-4px,0) scale(1.03); }
            100% { opacity: 0.18; transform: translate3d(-2px,3px,0) scale(1.01); }
        }

        @media (prefers-reduced-motion: reduce) {
            .bg-hero-animate,
            .star-twinkle-layer,
            .animate-fade-in,
            .animate-spin-slow {
                animation: none !important;
                transform: none !important;
            }
        }

        .safe-top { padding-top: env(safe-area-inset-top); }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>

<body class="flex justify-center min-h-screen">

<!-- æ‰‹æœºå±å¹•å®¹å™¨ -->
<div id="app"
     class="w-full max-w-[450px] bg-black relative shadow-2xl min-h-screen flex flex-col">

    <!-- å¼€å±èƒŒæ™¯ï¼ˆåŠ¨æ€ï¼‰ -->
    <div class="absolute inset-0 z-0 pointer-events-none">
        <div class="w-full h-full relative overflow-hidden">
            <!-- âš ï¸ å¼€å±èƒŒæ™¯å›¾ -->
            <img src="opening-bg.jpg"
                 alt=""
                 class="w-full h-full object-cover opacity-80 bg-hero-animate"
                 style="filter: saturate(1.1) contrast(1.05);">
            <div class="absolute inset-0 bg-gradient-to-b from-black/40 via-black/55 to-black/90"></div>
            <div class="star-twinkle-layer"></div>
        </div>
    </div>

    <!-- å†…å®¹å®¹å™¨ -->
    <div id="content" class="relative z-10 w-full flex-1 flex flex-col safe-top safe-bottom"></div>

    <!-- å¾®ä¿¡é¡¶éƒ¨æç¤º -->
    <div id="wx-tip"
         class="hidden fixed top-0 left-0 right-0 z-30 bg-black/80 text-white text-[11px] px-4 py-2 text-center">
        åœ¨å¾®ä¿¡ä¸­æµè§ˆæ—¶ï¼Œæ¨èç‚¹å‡»å³ä¸Šè§’ â€œÂ·Â·Â·â€ ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€ï¼Œä½“éªŒæ›´æµç•… ğŸ‘
    </div>
</div>

<script>
/* ---------------- é¢˜ç›® ---------------- */
const questions = [
    {
        id: 1, question: "ä½ çš„èƒ½é‡æ¥è‡ªå“ªé‡Œï¼Ÿ",
        options: [
            { text: "A. è¢«äººçœ‹è§ã€è¢«è®¤å¯", weights: ["peach", "cherry"] },
            { text: "B. ç‹¬å¤„æ—¶çš„çµæ„Ÿå’Œå¹»æƒ³", weights: ["kiwi", "watermelon"] },
            { text: "C. å¸®åŠ©åˆ«äººã€å¸¦æ¥æ¸©æš–", weights: ["lemon", "pomegranate"] }
        ]
    },
    {
        id: 2, question: "å½“æƒ…ç»ªä½è½æ—¶ï¼Œä½ ä¼šï¼Ÿ",
        options: [
            { text: "A. ç”¨ç¬‘æ©é¥°ä¸€åˆ‡ï¼Œå‡è£…æ²¡äº‹", weights: ["orange", "pineapple"] },
            { text: "B. è¿œç¦»äººç¾¤ï¼Œç‹¬è‡ªç–—æ„ˆ", weights: ["lemon", "dragonfruit"] },
            { text: "C. å»åšç‚¹æœ‰è¶£çš„äº‹è®©è‡ªå·±åŠ¨èµ·æ¥", weights: ["peach", "guava"] }
        ]
    },
    {
        id: 3, question: "åœ¨äººç¾¤ä¸­ï¼Œä½ é€šå¸¸æ˜¯ï¼Ÿ",
        options: [
            { text: "A. æ´»è·ƒçš„ä¸­å¿ƒäººç‰©", weights: ["peach", "orange"] },
            { text: "B. å†·é™è§‚å¯Ÿè€…", weights: ["kiwi", "sugarcane", "starfruit"] },
            { text: "C. è‡ªç„¶æµéœ²é­…åŠ›ï¼Œä¸åˆ»æ„ä½†è¢«å–œæ¬¢", weights: ["pineapple", "watermelon"] }
        ]
    },
    {
        id: 4, question: "ä½ æ›´ç›¸ä¿¡å“ªç§å¹¸ç¦ï¼Ÿ",
        options: [
            { text: "A. çƒ­çƒˆä¸”çŸ­æš‚çš„ç¬é—´", weights: ["peach", "cherry"] },
            { text: "B. é•¿ä¹…ç¨³å®šçš„é™ªä¼´", weights: ["pomegranate", "lemon"] },
            { text: "C. ç‹¬è‡ªä¹Ÿèƒ½å‘å…‰çš„è‡ªç”±", weights: ["kiwi", "guava", "dragonfruit"] }
        ]
    },
    {
        id: 5, question: "å¦‚æœç”¨ä¸€å¥è¯å½¢å®¹ä½ çš„äººç”Ÿæ€åº¦ï¼š",
        options: [
            { text: "A. â€œæˆ‘æƒ³è¢«çœ‹è§ã€‚â€", weights: ["peach", "cherry"] },
            { text: "B. â€œæˆ‘ä¸å®Œç¾ï¼Œä½†æˆ‘è‡ªç”±ã€‚â€", weights: ["guava", "dragonfruit"] },
            { text: "C. â€œæˆ‘ç”¨çˆ±å»ä¿®å¤ä¸€åˆ‡ã€‚â€", weights: ["lemon", "pomegranate"] }
        ]
    },
    {
        id: 6, question: "ä½ æœ€æ¸´æœ›åˆ«äººæ€æ ·çœ‹ä½ ï¼Ÿ",
        options: [
            { text: "A. é…·ã€æœ‰è¶£ã€ç‹¬ç‰¹", weights: ["kiwi", "starfruit", "pineapple"] },
            { text: "B. æ¸©æŸ”ã€æœ‰æ·±åº¦", weights: ["lemon", "pomegranate", "dragonfruit"] },
            { text: "C. è‡ªä¿¡ã€é—ªäº®ã€éš¾ä»¥å¿˜è®°", weights: ["peach", "cherry", "orange"] }
        ]
    }
];

/* ---------------- ç»“æœé…ç½®ï¼ˆä¿®æ­£è¯­æ³• + åŠ  artwork å­—æ®µï¼‰ ---------------- */
const results = {
    peach: {
        img: "peach.jpg",
        name: "æ¡ƒå­äººæ ¼",
        icon: "ğŸ‘",
        artwork: "ç”»ä½œã€Šæ¡ƒé†‰ã€‹",
        title: "è¢«çœ‹è§çš„è‰ºæœ¯å®¶",
        keywords: ["æŸ”è½¯","å¤–å‘","å¾®å­¤ç‹¬"],
        quote: "â€œæˆ‘å‡†å¤‡å¥½äº†è¢«çœ‹è§ã€‚â€",
        desc: "ç”œç¾åˆæœ‰ç‚¹å±é™©ï¼Œç¤¾äº¤é«˜æ‰‹ã€çµé­‚å­¤ç‹¬ã€‚ä½ è¯»æ‡‚åˆ«äººï¼Œä¹Ÿå¶å°”è¯»ä¸æ‡‚è‡ªå·±ï¼Œåœ¨è¢«å›´è§‚å’Œè¢«ç†è§£ä¹‹é—´æ¥å›æ‘‡æ‘†ã€‚",
        matchName: "æŸ æª¬äººæ ¼",
        matchDesc: "ä»–æ˜¯é…¸çš„è§£è¯ï¼Œä½ æ˜¯ç”œçš„å¼•çº¿ã€‚"
    },
    lemon: {
        img: "lemon.jpg",
        name: "æŸ æª¬äººæ ¼",
        icon: "ğŸ‹",
        artwork: "ç”»ä½œã€ŠLemonçš„æ•‘èµã€‹",
        title: "é…¸æ¶©çš„æ®‰é“è€…",
        keywords: ["æ¸…é†’","ç–—æ„ˆ","å¾®å…‰"],
        quote: "â€œé»‘å¤œè¶Šæ·±ï¼Œé…¸æ¥šè¶Šäº®ã€‚â€",
        desc: "ä½ æ˜¯åˆ€é”‹ä¸‹çš„æ¸©æŸ”æ²»æ„ˆè€…ã€‚çœ‹å¾—å¾ˆæ¸…æ¥šï¼Œä¹Ÿæ„Ÿå—å¾—å¾ˆæ·±ã€‚ä½ æ‡‚æ‰€æœ‰äººçš„éš¾ï¼Œå´å¾ˆå°‘æ‰¿è®¤è‡ªå·±çš„ç´¯ã€‚",
        matchName: "æ¡ƒå­äººæ ¼",
        matchDesc: "ä¸€ä¸ªæ•¢çˆ±ï¼Œä¸€ä¸ªæ•¢æ•‘ã€‚"
    },
    cherry: {
        img: "cherry.jpg",
        name: "è½¦å˜å­äººæ ¼",
        icon: "ğŸ’",
        artwork: "ç”»ä½œã€Šè½¦å˜å­åˆè§ã€‹",
        title: "ç²¾è‡´çš„å¹»æ¢¦å¨ƒå¨ƒ",
        keywords: ["å®Œç¾ä¸»ä¹‰","è¢«å‡è§†","èº«ä»½ç„¦è™‘"],
        quote: "â€œæˆ‘é—ªè€€ï¼Œä¹Ÿæ˜“ç¢ã€‚â€",
        desc: "ä½ å¤©ç”Ÿå¸¦ç€é•œå¤´æ„Ÿï¼Œèµ°åˆ°å“ªé‡Œéƒ½æ˜¯ç„¦ç‚¹ã€‚ä½†è¶Šè¢«çœ‹è§ï¼Œå°±è¶Šæ€•æš´éœ²è„†å¼±ã€‚ä½ åœ¨é—ªè€€ä¸è‡ªæˆ‘æ€€ç–‘ä¸­åå¤åˆ‡æ¢ã€‚",
        matchName: "æ¨æ¡ƒäººæ ¼",
        matchDesc: "æ£±è§’ä¸å…‰ç¯çš„æ‹¥æŠ±ã€‚"
    },
    pineapple: {
        img:"pineapple.jpg",
        name:"è èäººæ ¼",
        icon:"ğŸ",
        artwork: "ç”»ä½œã€Šå¤§å¤è èã€‹",
        title:"åˆ€é”‹ä¸Šçš„æ¸©æŸ”è´µæ—",
        keywords:["é‡å¿ƒ","è‡ªå¾‹","éšå¿"],
        quote:"â€œæˆ‘ç¬‘ç€è¢«åˆ‡å¼€ï¼Œå› ä¸ºæˆ‘æœ‰é‡‘è‰²çš„å¿ƒã€‚â€",
        desc:"ä½ å¼ºå¤§ã€æ¸…é†’ã€ç›®æ ‡æ˜ç¡®ã€‚åˆ«äººçœ‹åˆ°çš„æ˜¯ä½ çš„åˆºï¼Œå´å¿½ç•¥ä½ å†…é‡Œçš„é¦™å’Œç”œã€‚",
        matchName:"è¥¿ç“œäººæ ¼",
        matchDesc:"åˆ€ä¸æœè‚‰ï¼Œäº’ä¸ºæŸ”è½¯ã€‚"
    },
    kiwi:{
        img:"kiwi.jpg",
        name:"å¥‡å¼‚æœäººæ ¼",
        icon:"ğŸ¥",
        artwork: "ç”»ä½œã€Šå¥‡å¼‚æœé‡Œçš„åŸƒå¾·åˆ©æ‰å²›ã€‹",
        title:"å­¤å²›å¤©æ‰",
        keywords:["ç‹¬ç«‹","å†…æ•›","çµæ„Ÿ"],
        quote:"â€œæ€ªï¼Œä¹Ÿæ˜¯ä¸€ç§å¤©èµ‹ã€‚â€",
        desc:"ä½ æ˜¯æœ‰ç‚¹æ¯›èºã€åˆå¾ˆé€šé€çš„è‰ºæœ¯æ€ªèƒã€‚ä¸–ç•Œä¸ä¸€å®šæ‡‚ä½ ï¼Œä½†çµæ„Ÿæ°¸è¿œç«™åœ¨ä½ è¿™è¾¹ã€‚",
        matchName:"ç«é¾™æœäººæ ¼",
        matchDesc:"ç†æ€§ä¸è‰³ä¸½çš„å’Œå¼¦ã€‚"
    },
    guava:{
        img:"guava.jpg",
        name:"èŠ­ä¹äººæ ¼",
        icon:"ğŸ¥­",
        artwork: "ç”»ä½œã€ŠèŠ­ä¹å°±æ˜¯å¿«ä¹çš„ä¹ã€‹",
        title:"é‡è›®å¥³ç‹",
        keywords:["çƒ­çƒˆ","è‰æ ¹","åå›"],
        quote:"â€œæˆ‘ä¸å®Œç¾ï¼Œä½†æˆ‘çœŸå®ã€‚â€",
        desc:"ä½ ä»ä¸ä¼ªè£…ï¼Œæƒ…ç»ªæ¥å°±æ¥ï¼Œèµ°å°±èµ°ã€‚ä½ æ˜¯äººç¾¤é‡Œæœ€åµé—¹çš„ä¸€é¢—å¿ƒï¼Œä¹Ÿæ˜¯æœ€çœŸè¯šçš„ä¸€é¢—å¿ƒã€‚",
        matchName:"çŸ³æ¦´äººæ ¼",
        matchDesc:"é‡ä¸æŸ”çš„å¹³è¡¡ã€‚"
    },
    pomegranate:{
        img:" pomegranate.jpg",
        name:"çŸ³æ¦´äººæ ¼",
        icon:"ğŸ…",
        artwork: "ç”»ä½œã€ŠçŸ³æ¦´è£™ä¸‹ã€‹",
        title:"è¢«èµç¾çš„ç‰ºç‰²è€…",
        keywords:["æ¯æ€§","æ‰¿å—","é‡ç”Ÿ"],
        quote:"â€œæˆ‘çˆ±æ‰€æœ‰äººï¼Œä¹Ÿæƒ³è¢«è‡ªå·±çˆ±ã€‚â€",
        desc:"ä½ æ€»æ˜¯å…ˆç…§é¡¾åˆ«äººï¼Œå†æƒ³èµ·è‡ªå·±ã€‚ä½ æ“…é•¿ä»˜å‡ºï¼Œä¹Ÿåœ¨å­¦ç€æ‹’ç»ã€‚ä½ çš„æ¸©æŸ”ä¸æ˜¯å¤©ç”Ÿçš„è®¨å¥½ï¼Œè€Œæ˜¯è¢«ç£¨å‡ºæ¥çš„åŠ›é‡ã€‚",
        matchName:"èŠ­ä¹äººæ ¼",
        matchDesc:"ä¸€ä¸ªæ•™å¯¹æ–¹æ´»ï¼Œä¸€ä¸ªæ•™å¯¹æ–¹çˆ±ã€‚"
    },
    sugarcane:{
        img:"sugarcane.jpg",
        name:"ç”˜è”—äººæ ¼",
        icon:"ğŸ§ƒ",
        artwork: "ç”»ä½œã€Šç”˜è”—å¾®ç”œã€‹",
        title:"ç”œçš„å¥‰çŒ®è€…",
        keywords:["æ¸©é¡º","éšå¿","è‹é†’"],
        quote:"â€œè¿™æ¬¡ï¼Œæˆ‘ä¸ºè‡ªå·±ç”œã€‚â€",
        desc:"ä½ ä¹ æƒ¯æŠŠå¥½ä¸œè¥¿ç•™ç»™åˆ«äººï¼ŒæŠŠå‹åŠ›ç•™ç»™è‡ªå·±ã€‚ç›´åˆ°æœ‰ä¸€å¤©ï¼Œä½ ç»ˆäºæ„è¯†åˆ°ï¼šä½ çš„ç”œï¼Œä¹Ÿå¯ä»¥åªä¸ºè‡ªå·±ä¿ç•™ã€‚",
        matchName:"è èäººæ ¼",
        matchDesc:"ç”œé‡ä¸Šåˆºï¼Œæ‰æˆå°±å®Œæ•´çš„å‘³é“ã€‚"
    },
    watermelon:{
        img:"watermelon.jpg",
        name:"è¥¿ç“œäººæ ¼",
        icon:"ğŸ‰",
        artwork: "ç”»ä½œã€Šç“œä¿ç”œæ˜Ÿçƒå¿ƒè„ä¿ç†Ÿã€‹",
        title:"å®‡å®™æµªæ¼«å®¶",
        keywords:["æµåŠ¨","æ¬¢ä¹","å®½å®¹"],
        quote:"â€œæˆ‘ä¸æ€•è™šæ— ï¼Œå› ä¸ºæˆ‘è‡ªå¸¦å¼•åŠ›ã€‚â€",
        desc:"ä½ è‡ªç”±ã€æ¾å¼›ã€å¯¹ä¸–ç•Œä¿æŒå¥½å¥‡å¿ƒã€‚ä½ ä¸å¼ºæ±‚åˆ«äººç•™ä¸‹ï¼Œä½†æ„¿æ„ä¸ºå–œæ¬¢çš„äººä¸€ç›´äº®ç€ã€‚",
        matchName:"è èäººæ ¼",
        matchDesc:"é˜³å…‰æ’ä¸Šé‡‘è‰²ã€‚ä½ è®©TAè½¯ä¸€ç‚¹ï¼ŒTAè®©ä½ ç¨³ä¸€ç‚¹ã€‚"
    },
    dragonfruit:{
        img:"dragonfruit.jpg",
        name:"ç«é¾™æœäººæ ¼",
        icon:"ğŸ‰",
        artwork: "ç”»ä½œã€Šç™½èŠ¯ç«é¾™æœçš„è‡´å‘½ä¸€å‡»ã€‹",
        title:"è‰³ä¸½çš„å¹¸å­˜è€…",
        keywords:["è‰ºæœ¯","æƒ…ç»ª","çœŸå¿ƒ"],
        quote:"â€œæˆ‘äº®è¿‡ï¼Œä¹Ÿç—›è¿‡ã€‚â€",
        desc:"ä½ åƒä¸€åœºæ°¸è¿œä¸ä¼šé‡æ¼”çš„ç°åœºæ¼”å‡ºã€‚å¤–è¡¨é²œè‰³ã€è¯­æ°”è½»æ¾ï¼Œå¿ƒé‡Œå´è—ç€å¾ˆå¤šæ²¡äººçŸ¥é“çš„é»‘æ´ã€‚",
        matchName:"å¥‡å¼‚æœäººæ ¼",
        matchDesc:"è‰³ä¸½ä¸å­¤ç‹¬çš„ç–—æ„ˆã€‚ä½ ä»¬äº’ç›¸æ‰¿è®¤å¯¹æ–¹çš„å¥‡æ€ªï¼Œä¹Ÿäº’ç›¸å®ˆæŠ¤å¯¹æ–¹çš„æ•æ„Ÿã€‚"
    },
    orange:{
        img:"orange.jpg",
        name:"æ©™å­äººæ ¼",
        icon:"ğŸŠ",
        artwork: "ç”»ä½œã€Šæ©™äº¤ã€‹",
        title:"å…ƒæ°”ä¹å¤©æ´¾",
        keywords:["é˜³å…‰","æ©é¥°","æ´»åŠ›"],
        quote:"â€œæˆ‘çš„å¿«ä¹ï¼Œæ˜¯ä½ çš„å…‰ã€‚â€",
        desc:"ä½ æ˜¯æ‰€æœ‰äººå¿ƒé‡Œçš„å°å¤ªé˜³ã€‚ä½ ä¹ æƒ¯ç”¨ç¬‘å’Œæ®µå­æŒ¡ä½é»‘æš—ï¼Œä½†çœŸæ­£ç†è§£ä½ çš„äººå¹¶ä¸å¤šã€‚",
        matchName:"è¥¿ç“œäººæ ¼",
        matchDesc:"å¿«ä¹å åŠ å¿«ä¹ã€‚ä½ ä»¬ä¼šä¸€èµ·æŠŠæ—¥å¸¸è¿‡æˆå¤å¤©ã€‚"
    },
    starfruit:{
        img:"starfruit.jpg",
        name:"æ¨æ¡ƒäººæ ¼",
        icon:"â­",
        artwork: "ç”»ä½œã€Šæ¨æ¡ƒä¹Ÿè®¸æ˜¯æˆ‘çš„è‡ªç”»åƒå§ã€‹",
        title:"å­¤ç‹¬çš„ç†æƒ³å®¶",
        keywords:["æ£±è§’","ç‹¬ç‰¹","æ´å¯Ÿ"],
        quote:"â€œæˆ‘æ˜¯æ˜Ÿæ˜Ÿçš„åˆ‡ç‰‡ã€‚â€",
        desc:"ä½ æœ‰é”‹åˆ©çš„è¾¹ï¼Œä¹Ÿæœ‰æŸ”è½¯çš„å¿ƒã€‚ä½ çœ‹ç©¿å¾ˆå¤šè™šå‡ï¼Œåˆä¸æ„¿è½»æ˜“è¯´ç ´ï¼Œåªæ˜¯æ‚„æ‚„ä¿æŒè·ç¦»ã€‚",
        matchName:"è½¦å˜å­äººæ ¼",
        matchDesc:"æ£±è§’ä¸å…‰ç¯çš„æ‹¥æŠ±ã€‚ä½ ä»¬ä¸€ä¸ªè´Ÿè´£åšæ¢¦ï¼Œä¸€ä¸ªè´Ÿè´£æ‹†æ¢¦ã€‚"
    }
};

/* ---------------- çŠ¶æ€ç®¡ç† ---------------- */
let currentState = {
    view: 'start',
    currentQ: 0,
    answers: [],
    finalResult: null
};

const app = document.getElementById('content');

/* ---------------- æ¸²æŸ“é€»è¾‘ ---------------- */
function render() {
    app.innerHTML = '';
    if (currentState.view === 'start') renderStart();
    else if (currentState.view === 'quiz') renderQuiz();
    else if (currentState.view === 'loading') renderLoading();
    else if (currentState.view === 'result') renderResult();
}

/* é¦–é¡µ */
function renderStart() {
    const thumbFruits = [
        { key:'peach', img:'peach.jpg' },
        { key:'lemon', img:'lemon.jpg' },
        { key:'orange', img:'orange.jpg' },
        { key:'kiwi', img:'kiwi.jpg' },
        { key:'pineapple', img:'pineapple.jpg' },
        { key:'pomegranate', img:'pomegranate.jpg' },
        { key:'starfruit', img:'starfruit.jpg' },
        { key:'watermelon', img:'watermelon.jpg' }
    ];

    const html = `
    <div class="flex flex-col justify-between min-h-screen px-6 pt-10 pb-10 animate-fade-in">
        <header class="mb-4">
            <div class="text-[10px] tracking-[0.4em] opacity-70 mb-2">
                ROACYZHENG Â· FRUIT UNIVERSE
            </div>
            <h1 class="text-3xl font-bold leading-snug drop-shadow-[0_0_14px_rgba(255,160,80,0.9)]">
                ä½ çš„<span class="text-orange-300">æ°´æœäººæ ¼</span><br/>ç»é…æ˜¯è°ï¼Ÿ
            </h1>
        </header>

        <section class="mt-4 mb-8">
            <div class="w-full rounded-3xl border border-white/15 bg-black/35 backdrop-blur-md px-4 py-4">
                <div class="text-[11px] opacity-70 mb-3">
                    åœ¨è‰ºæœ¯å®¶ <span class="font-semibold">éƒ‘å†²</span> çš„ã€Œæ°´æœå®‡å®™ã€é‡Œï¼Œ<br/>
                    æ¯ä¸€é¢—æœå®ï¼Œéƒ½æ˜¯ä¸€ä¸ªçµé­‚çš„éšå–»ã€‚
                </div>
                <div class="flex items-center gap-3 overflow-x-auto pb-1">
                    ${thumbFruits.map(f => `
                        <div class="flex-shrink-0 w-12 h-12 rounded-full border border-white/40 overflow-hidden shadow-md">
                            <img src="${f.img}" class="w-full h-full object-cover" />
                        </div>
                    `).join('')}
                </div>
            </div>
        </section>

        <section class="mb-6 text-[11px] opacity-65 leading-relaxed">
            èŠ± 1 åˆ†é’Ÿç­” 6 é¢˜ï¼Œçœ‹çœ‹ä½ æ˜¯å“ªä¸ªæ°´æœäººæ ¼ï¼Œ
            ä»¥åŠå‘½ä¸­æ³¨å®šçš„é‚£é¢—ã€Œç»é…æœã€æ˜¯è°ã€‚
        </section>

        <footer class="flex flex-col items-center gap-4">
            <button onclick="startQuiz()"
                class="w-full max-w-[260px] py-3.5 bg-gradient-to-r from-orange-400 to-pink-500 rounded-full
                       font-bold text-lg shadow-[0_0_20px_rgba(255,165,0,0.55)]
                       hover:scale-105 transition-transform active:scale-95">
                å¼€å§‹åˆ‡å¼€çµé­‚ â†’
            </button>
            <div class="text-[10px] opacity-40 tracking-[0.25em]">
                SCREENSHOT Â· SHARE Â· TAG @ROACYZHENG
            </div>
        </footer>
    </div>
    `;
    app.innerHTML = html;
}

/* ç­”é¢˜é¡µ */
function renderQuiz() {
    const q = questions[currentState.currentQ];
    const progress = ((currentState.currentQ + 1) / questions.length) * 100;

    const html = `
        <div class="min-h-screen px-6 pt-6 pb-8 flex flex-col animate-fade-in">

            <div class="mb-4">
                <div class="flex justify-between items-center mb-2">
                    <div class="text-xs tracking-[0.25em] opacity-70">FRUIT TEST</div>
                    <div class="text-[11px] opacity-70">${currentState.currentQ + 1} / ${questions.length}</div>
                </div>
                <div class="h-1 bg-white/10 rounded-full overflow-hidden">
                    <div class="h-full bg-orange-400 transition-all duration-500 ease-out" style="width:${progress}%"></div>
                </div>
            </div>

            <div class="flex-1">
                <div class="mb-6">
                    <div class="text-xs uppercase opacity-60 tracking-[0.24em] mb-1">
                        Question ${currentState.currentQ + 1}
                    </div>
                    <h2 class="text-2xl font-bold leading-relaxed drop-shadow-md">
                        ${q.question}
                    </h2>
                </div>

                <div class="space-y-4">
                    ${q.options.map((opt,i)=>`
                        <button onclick="handleAnswer(${i})"
                            class="w-full text-left p-5 rounded-2xl bg-black/45 border border-white/15
                                   backdrop-blur-md hover:bgç™½è‰²/10 hover:border-orange-400/60
                                   transition-all active:scale-[0.97]">
                            <span class="text-base opacity-90">${opt.text}</span>
                        </button>
                    `).join('')}
                </div>
            </div>

            <div class="mt-8 text-[11px] opacity-45 text-center leading-relaxed">
                ä¸ç”¨åå¤çº ç»“ï¼Œç¬¬ä¸€ååº”é€šå¸¸å°±æ˜¯ä½ çœŸå®çš„æ°´æœå†…æ ¸ã€‚
            </div>
        </div>`;
    app.innerHTML = html;
}

/* Loading é¡µé¢ */
function renderLoading() {
    app.innerHTML = `
        <div class="min-h-screen bg-black flex flex-col items-center justify-center relative overflow-hidden">
            <div class="w-48 h-48 rounded-full bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500
                        blur-2xl opacity-70 animate-spin-slow"></div>
            <div class="absolute bottom-32 text-xs tracking-[0.5em] font-light text-white/80">
                æ­£åœ¨åˆ‡å¼€çµé­‚...
            </div>
        </div>
    `;
    setTimeout(()=>{ currentState.view='result'; render(); },2800);
}

/* ç»“æœé¡µ */
function renderResult() {
    const res = currentState.finalResult;
    const matchRes = Object.values(results).find(r => r.name === res.matchName) || results.peach;

    const html = `
    <div class="min-h-screen overflow-y-auto pb-32 animate-fade-in relative">
        <div class="px-6 pt-6 flex justifyä¹‹é—´ items-center opacity-80 text-[11px]">
            <span class="tracking-[0.28em]">FRUIT Â· UNIVERSE</span>
            <button onclick="location.reload()"
                    class="px-2 py-1 rounded-full bg-white/8 border border-white/16">
                é‡æ–°æµ‹è¯•
            </button>
        </div>

        <div class="px-6 flex flex-col items-center mt-3">

            <!-- â€œä½ çš„ç»é…æ°´æœäººæ ¼æ˜¯â€ æç¤º -->
            <div class="mt-3 text-sm tracking-[0.25em] text-orange-200/90 text-center">
                ä½ çš„ç»é…æ°´æœäººæ ¼æ˜¯
            </div>

            <!-- ä¸»äººæ ¼æ²¹ç”»å¤§åœ† -->
            <div class="w-64 h-64 rounded-full border-2 border-white/25 p-2 mb-6 mt-2 relative">
                <div class="w-full h-full rounded-full overflow-hidden shadow-[0_0_36px_rgba(255,255,250,0.32)]
                            bg-black flex items-center justify-center">
                    <img src="${res.img}" class="w-full h-full object-cover" alt="${res.name}">
                    <div class="absolute inset-0 bg-gradient-to-br from-black/5 via-transparent to-black/25"></div>
                </div>
                <div class="absolute -bottom-3 left-1/2 -translate-x-1/2 text-[11px] px-3 py-1 rounded-full
                            bg-black/70 border border-white/30 shadow-md">
                    ${res.icon}  ${res.name}
                </div>
            </div>

            <!-- äººæ ¼æ ‡é¢˜ -->
            <h1 class="text-3xl serif font-bold mb-1 text-center">
                ${res.title}
            </h1>

            <!-- ç”»ä½œåç§° -->
            <div class="text-xs opacity-70 mb-4 text-center">
                ${res.artwork}
            </div>

            <div class="flex flex-wrap justify-center gap-2 mb-8">
                ${res.keywords.map(k=>`
                    <span class="text-xs px-3 py-1 rounded-full border border-white/20 bg-white/6 text-orange-100">
                        ${k}
                    </span>`).join('')}
            </div>

            <div class="text-lg serif italic opacity-90 text-center mb-8 leading-relaxed max-w-xs">
                ${res.quote}
            </div>

            <div class="w-full bg-black/55 backdrop-blur-xl rounded-2xl p-6 border border-white/14 mb-10">
                <h3 class="text-[11px] opacity-60 uppercase tracking-wider mb-2">
                    äººæ ¼åˆ‡ç‰‡ Â· Analysis
                </h3>
                <p class="text-sm leading-7 text-gray-100 text-justify">
                    ${res.desc}
                </p>
            </div>

            <!-- ç»é…äººæ ¼åŒº -->
            <div class="w-full bg-gradient-to-r from-indigo-900/70 to-purple-900/70
                        rounded-2xl p-6 border border-white/16 mb-10 relative overflow-hidden">
                <div class="absolute -right-16 -top-16 w-40 h-40 rounded-full bg-white/10 blur-3xl"></div>

                <div class="relative z-10 flex gap-4 items-center">
                    <div class="w-16 h-16 rounded-full border border-white/30 overflow-hidden shadow-lg flex-shrink-0">
                        <img src="${matchRes.img}" class="w-full h-full object-cover" alt="${res.matchName}">
                    </div>
                    <div class="flex-1">
                        <div class="text-[11px] uppercase opacity-60 tracking-[0.2em] mb-1">
                            Soulmate Fruit
                        </div>
                        <div class="font-semibold mb-2">
                            ${res.matchName}
                        </div>
                        <p class="text-xs opacity-90 leading-relaxed italic border-l-2 border-white/40 pl-3">
                            ${res.matchDesc}
                        </p>
                    </div>
                </div>
            </div>

            <!-- åŠ ç¾¤äºŒç»´ç åŒº -->
            <div class="w-full bg-black/60 backdrop-blur-xl rounded-2xl p-6 border border-dashed border-white/25 mb-8">
                <div class="text-center mb-4">
                    <div class="text-sm font-semibold mb-1">åŠ å…¥ã€Œæ°´æœå®‡å®™ã€å°ç¾¤</div>
                    <div class="text-[11px] opacity-70 leading-relaxed">
                        æ‰«ææˆ–é•¿æŒ‰è¯†åˆ«ä¸‹æ–¹äºŒç»´ç ï¼Œ<br/>
                        å’Œæ›´å¤šæ°´æœäººæ ¼ä¸€èµ·èŠå¤©ã€æ™’å›¾ã€äº¤æ¢å‘½ç›˜ ğŸ‘
                    </div>
                </div>
                <div class="flex justify-center">
                    <!-- âš ï¸ æŠŠqr-fruit-universe.jpg æ¢æˆä½ çš„äºŒç»´ç æ–‡ä»¶å -->
                    <img src="qr-fruit-universe.jpg "
                         alt="æ°´æœå®‡å®™ç¾¤äºŒç»´ç "
                         class="w-40 h-40 rounded-xl border border-white/40 bg-white object-contain">
                </div>
                <div class="mt-3 text-[11px] opacity-60 text-center">
                    åœ¨å¾®ä¿¡ä¸­å¯ä»¥é•¿æŒ‰äºŒç»´ç å›¾ç‰‡è¯†åˆ«åŠ å…¥ï¼›<br/>
                    ä¹Ÿå¯ä»¥é•¿æŒ‰å…¨å±æˆªå›¾ï¼Œå‘åˆ°æœ‹å‹åœˆ / ç¾¤èŠåˆ†äº«ä½ çš„æ°´æœäººæ ¼ã€‚
                </div>
            </div>

            <div class="w-full text-center text-[11px] opacity-55 pb-6 leading-relaxed">
                Â· é•¿æŒ‰æˆªå›¾ï¼Œä¿å­˜ä½ çš„æ°´æœäººæ ¼ Â·<br/>
                æ¬¢è¿åˆ†äº«åˆ°ç¤¾äº¤å¹³å°ï¼Œtag <span class="font-semibold">@ROACYZHENG</span>
            </div>
        </div>
    </div>
    `;
    app.innerHTML = html;
}

/* äº¤äº’é€»è¾‘ */
function startQuiz() {
    currentState = { view:'quiz', currentQ:0, answers:[], finalResult:null };
    render();
}

function handleAnswer(i) {
    currentState.answers.push(i);
    if (currentState.currentQ < questions.length - 1) {
        currentState.currentQ++;
        render();
    } else {
        calculateResult();
        currentState.view='loading';
        render();
    }
}

function calculateResult() {
    let scores = {};
    currentState.answers.forEach((choice,qIndex)=>{
        questions[qIndex].options[choice].weights.forEach(f=>{
            scores[f] = (scores[f]||0) + 1;
        });
    });

    let max = Math.max(...Object.values(scores));
    let winners = Object.keys(scores).filter(f=>scores[f]===max);
    currentState.finalResult = results[winners[Math.floor(Math.random()*winners.length)]];
}

/* å¾®ä¿¡ç¯å¢ƒæ£€æµ‹ï¼šåªåšæç¤ºï¼Œè§£å†³ä¸äº† github.io è¢«å¢™çš„é—®é¢˜ */
(function detectWeChat() {
    if (/micromessenger/.test(navigator.userAgent.toLowerCase())) {
        const tip = document.getElementById('wx-tip');
        if (tip) tip.classList.remove('hidden');
    }
})();

render();
</script>

</body>
</html>
